(()=>{"use strict";var e={d:(o,n)=>{for(var a in n)e.o(n,a)&&!e.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:n[a]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};e.r(o),e.d(o,{activate:()=>c});const n=require("vscode"),a=require("child_process"),r=require("path");var t=n.window.createOutputChannel("Pandoc");function i(e,o){var a=e+" ["+o+"] "+(new Date).toLocaleTimeString();n.window.setStatusBarMessage(a,1500)}function c(e){var o=n.commands.registerCommand("pandoc.render",(()=>{const e=n.window.activeTextEditor;if(!e)return;let o=r.normalize(e.document.fileName);var c=r.dirname(o),d=r.basename(o),p=r.parse(d).name;let s=[];s.push({label:"pdf",description:"Render as pdf document"}),s.push({label:"docx",description:"Render as word document"}),s.push({label:"html",description:"Render as html document"}),s.push({label:"asciidoc",description:"Render as asciidoc document"}),s.push({label:"docbook",description:"Render as docbook document"}),s.push({label:"epub",description:"Render as epub document"}),s.push({label:"rst",description:"Render as rst document"}),n.window.showQuickPick(s).then((e=>{var o,s,u,g,l,k;if(e){var b=r.join(c,d).replace(/(^.*$)/gm,'"$1"'),f=(r.join(c,p)+"."+e.label).replace(/(^.*$)/gm,'"$1"');i("Generating",e.label);var w=function(e){var o;switch(e){case"pdf":o=n.workspace.getConfiguration("pandoc").get("pdfOptString");break;case"docx":o=n.workspace.getConfiguration("pandoc").get("docxOptString");break;case"html":o=n.workspace.getConfiguration("pandoc").get("htmlOptString");break;case"asciidoc":o=n.workspace.getConfiguration("pandoc").get("asciidocOptString");break;case"docbook":o=n.workspace.getConfiguration("pandoc").get("docbookOptString");break;case"epub":o=n.workspace.getConfiguration("pandoc").get("epubOptString");break;case"rst":o=n.workspace.getConfiguration("pandoc").get("rstOptString")}return o}(e.label),v=function(){var e;return console.log(n.workspace.getConfiguration("pandoc").get("executable")),n.workspace.getConfiguration("pandoc").has("executable")&&""!==n.workspace.getConfiguration("pandoc").get("executable")&&(e=n.workspace.getConfiguration("pandoc").get("executable")),e}(),m=n.workspace.getConfiguration("pandoc"),h=null!==(s=null===(o=m.inspect("useDocker"))||void 0===o?void 0:o.globalValue)&&void 0!==s?s:void 0;void 0!==h&&(t.append('migrating global configuration "pandoc.useDocker" -> "pandoc.docker.enabled"\n'),n.window.showWarningMessage('pandoc: found deprecated value in global configuration. Migrating configuration "pandoc.useDocker" -> "pandoc.docker.enabled".'),m.update("docker.enabled",h,n.ConfigurationTarget.Global),m.update("useDocker",void 0,n.ConfigurationTarget.Global));var C=null!==(g=null===(u=m.inspect("useDocker"))||void 0===u?void 0:u.workspaceValue)&&void 0!==g?g:void 0;void 0!==C&&(t.append('migrating workspace configuration "pandoc.useDocker" -> "pandoc.docker.enabled"\n'),n.window.showWarningMessage('pandoc: found deprecated value in workspace configuration. Migrating configuration "pandoc.useDocker" -> "pandoc.docker.enabled".'),m.update("docker.enabled",C,n.ConfigurationTarget.Workspace),m.update("useDocker",void 0,n.ConfigurationTarget.Workspace));var x=null!==(k=null===(l=m.inspect("useDocker"))||void 0===l?void 0:l.workspaceFolderValue)&&void 0!==k?k:void 0;void 0!==x&&(t.append('migrating folder configuration "pandoc.useDocker" -> "pandoc.docker.enabled"\n'),n.window.showWarningMessage('pandoc: found deprecated value in folder configuration. Migrating configuration "pandoc.useDocker" -> "pandoc.docker.enabled".'),m.update("docker.enabled",x,n.ConfigurationTarget.WorkspaceFolder),m.update("useDocker",void 0,n.ConfigurationTarget.WorkspaceFolder));var S=m.get("docker.enabled"),$=m.get("docker.options"),D=m.get("docker.image"),O=S?`docker run --rm -v "${c}:/data" ${$} ${D} "${d}" -o "${p}.${e.label}" ${w}`:`"${v}" ${b} -o ${f} ${w}`;(0,a.exec)(O,{cwd:c},(function(o,r,c){null!==r&&t.append(r.toString()+"\n"),null!==c&&""!==c&&(n.window.showErrorMessage("stderr: "+c.toString()),t.append("stderr: "+c.toString()+"\n")),null!==o?(n.window.showErrorMessage("exec error: "+o),t.append("exec error: "+o+"\n")):n.workspace.getConfiguration("pandoc").get("render.openViewer")&&(i("Launching",e.label),function(e){switch(process.platform){case"darwin":(0,a.exec)("open "+e);break;case"linux":(0,a.exec)("xdg-open "+e);break;default:(0,a.exec)(e)}}(f))}))}}))}));e.subscriptions.push(o)}module.exports=o})();